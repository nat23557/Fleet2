{% extends "index.html" %}
{% load static %}

{% block content %}
<div class="dashboard" style="max-width:1000px;margin-inline:auto;">
  <div class="dashboard-hero" style="margin-bottom:1rem;">
    <div class="dashboard-hero-main">
      <h1 style="margin:0;">Cash Management</h1>
      <p class="dashboard-subtext">Accounts and running balances.</p>
    </div>
  </div>

  <section class="section" style="margin-top:.25rem;">
    <div class="section-header">
      <div class="section-title">Cash Snapshot</div>
      <div class="segmented">
        <a class="seg-item {% if not selected_currency %}active{% endif %}" href="{% url 'cash_management:dashboard' %}">All</a>
        <a class="seg-item {% if selected_currency == 'ETB' %}active{% endif %}" href="{% url 'cash_management:dashboard' %}?currency=ETB">ETB</a>
        <a class="seg-item {% if selected_currency == 'USD' %}active{% endif %}" href="{% url 'cash_management:dashboard' %}?currency=USD">USD</a>
      </div>
    </div>
    <div class="kpi-grid">
      <div class="kpi-card accent-green">
        <div class="kpi-title">ETB Accounts</div>
        <div class="kpi-value">{{ total_etb_native|floatformat:2 }}</div>
      </div>
      <div class="kpi-card accent-blue">
        <div class="kpi-title">USD Accounts</div>
        <div class="kpi-value">{{ total_usd_native|floatformat:2 }}</div>
      </div>
      <div class="kpi-card accent-purple">
        <div class="kpi-title">FOREX in ETB</div>
        <div class="kpi-value">{{ total_forex_to_etb|default:0|floatformat:2 }}</div>
      </div>
      <div class="kpi-card accent-amber">
        <div class="kpi-title">Grand Total (ETB)</div>
        <div class="kpi-value">{{ grand_total|default:0|floatformat:2 }}</div>
      </div>
      <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;">
        <a class="btn" href="{% url 'cash_management:banks' %}{% if selected_currency %}?currency={{ selected_currency }}{% endif %}">üè¶ View Banks</a>
        <a class="btn btn-ghost" href="{% url 'cash_management:analytics' %}">üìà Analytics</a>
        <a class="btn btn-ghost" href="{% url 'cash_management:cash_summary' %}">üßÆ Cash Summary</a>
      </div>
    </div>
    {# Forex rate chips intentionally removed; rates shown on Cash Summary only. #}
  </section>

  <section class="section" style="margin-top:.5rem;">
    <div class="section-header">
      <div class="section-title">Bank Accounts {% if selected_currency %}<span class="text-muted">‚Ä¢ {{ selected_currency }}</span>{% endif %}</div>
      <div>
        {% if can_add_txn %}
        <a class="cta-button btn-sm" href="{% url 'cash_management:new_transaction' %}">‚ûï New Transaction</a>
        {% endif %}
      </div>
    </div>
    <div class="list cash-list">
      {% for a in account_rows %}
        <a class="list-item" href="{{ a.url }}">
          <div class="item-meta">
            <div class="meta-title">{{ a.name }}</div>
            <div class="meta-sub">{{ a.bank_name }} ‚Ä¢ {{ a.currency }}</div>
          </div>
          <div class="amount-wrap">
            <div class="kpi-value" style="font-variant-numeric:tabular-nums;">
              {{ a.balance|default:0|floatformat:2 }}
              <span class="ccy">{{ a.currency }}</span>
            </div>
            {% if a.rate %}
            <div class="etb-equivalent">‚âà {{ a.etb_equiv|floatformat:2 }} ETB</div>
            {% endif %}
            {% if a.below_threshold %}
            <span class="threshold-badge" title="Below threshold">‚ö†</span>
            {% endif %}
          </div>
        </a>
      {% empty %}
        <div class="empty">No bank accounts yet.</div>
      {% endfor %}
    </div>
  </section>
</div>
{% endblock %}
