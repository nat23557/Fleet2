# Generated by Django 4.2.19 on 2025-11-11 15:31

import WareDGT.models
from decimal import Decimal
from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='StockSeries',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('owner_id', models.UUIDField()),
                ('warehouse_id', models.UUIDField()),
                ('seed_type', models.CharField(max_length=10)),
                ('grade', models.CharField(blank=True, max_length=50)),
                ('ts', models.DateField()),
                ('balance_kg', models.DecimalField(decimal_places=2, max_digits=12)),
                ('inflow_kg', models.DecimalField(decimal_places=2, max_digits=12)),
                ('outflow_kg', models.DecimalField(decimal_places=2, max_digits=12)),
                ('purity_wavg', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('doc_integrity', models.FloatField()),
            ],
            options={
                'db_table': 'v_bincard_stock_series',
                'managed': False,
            },
        ),
        migrations.CreateModel(
            name='AuthEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ts', models.DateTimeField(auto_now_add=True)),
                ('username', models.CharField(max_length=150)),
                ('event', models.CharField(max_length=32)),
                ('meta', models.JSONField(blank=True, default=dict)),
            ],
        ),
        migrations.CreateModel(
            name='BinCardEntry',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('grade', models.CharField(blank=True, max_length=50)),
                ('date', models.DateField(auto_now_add=True)),
                ('in_out_no', models.CharField(blank=True, max_length=50, validators=[django.core.validators.RegexValidator('^\\d+$', 'In/out number must be numeric')])),
                ('description', models.CharField(blank=True, max_length=255)),
                ('weight', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('balance', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('remark', models.CharField(blank=True, max_length=255)),
                ('cleaned_weight', models.DecimalField(decimal_places=2, default=0, help_text='Total weight cleaned from this lot', max_digits=12)),
                ('raw_weight_remaining', models.DecimalField(decimal_places=2, default=0, help_text='Raw weight remaining to be processed', max_digits=12)),
                ('raw_balance_kg', models.DecimalField(decimal_places=3, default=Decimal('0.000'), help_text='Raw balance (quintals)', max_digits=12)),
                ('cleaned_total_kg', models.DecimalField(decimal_places=3, default=Decimal('0.000'), help_text='Total cleaned stock (quintals)', max_digits=12)),
                ('rejects_total_kg', models.DecimalField(decimal_places=3, default=Decimal('0.000'), help_text='Total reject stock (quintals)', max_digits=12)),
                ('last_cleaned_at', models.DateTimeField(blank=True, null=True)),
                ('initial_stock_balance_type_qtl', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('initial_stock_balance_grade_qtl', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('source_type', models.CharField(choices=[('ECX', 'ECX'), ('CONTRACT', 'Contract Farming'), ('LOCAL', 'Local Purchase')], default='CONTRACT', max_length=20)),
                ('num_bags', models.IntegerField(default=0)),
                ('car_plate_number', models.CharField(blank=True, max_length=20)),
                ('warehouse_document_number', models.CharField(blank=True, max_length=50)),
                ('purity', models.DecimalField(decimal_places=2, default=0, max_digits=5, verbose_name='Purity (%)')),
                ('unloading_rate_etb_per_qtl', models.DecimalField(blank=True, decimal_places=4, help_text='Labor cost per quintal (ETB) for unloading', max_digits=12, null=True)),
                ('loading_rate_etb_per_qtl', models.DecimalField(blank=True, decimal_places=4, help_text='Labor cost per quintal (ETB) for loading', max_digits=12, null=True)),
                ('weighbridge_certificate', models.FileField(blank=True, upload_to='bincard/weighbridge/%Y/%m/%d/')),
                ('warehouse_document', models.FileField(blank=True, upload_to='bincard/warehouse_docs/%Y/%m/%d/')),
                ('quality_form', models.FileField(blank=True, upload_to='bincard/quality_forms/%Y/%m/%d/')),
                ('pdf_file', models.FileField(blank=True, editable=False, upload_to='bincard/pdfs/%Y/%m/%d/')),
                ('pdf_generated_at', models.DateTimeField(blank=True, null=True)),
                ('pdf_dirty', models.BooleanField(default=False)),
                ('pdf_fingerprint', models.CharField(blank=True, max_length=64)),
                ('tracking_scope', models.CharField(choices=[('FULL', 'Full'), ('LIMITED', 'Limited')], default='FULL', max_length=10)),
                ('pl_no', models.CharField(blank=True, max_length=50)),
                ('r_no', models.CharField(blank=True, max_length=50)),
                ('service_rate_etb_per_qtl', models.DecimalField(blank=True, decimal_places=4, max_digits=12, null=True)),
                ('storage_rate_etb_per_day', models.DecimalField(blank=True, decimal_places=4, max_digits=12, null=True)),
                ('storage_days', models.IntegerField(blank=True, null=True)),
                ('storage_fee_etb', models.DecimalField(blank=True, decimal_places=2, max_digits=14, null=True)),
            ],
            options={
                'ordering': ['seed_type', 'date'],
            },
        ),
        migrations.CreateModel(
            name='Commodity',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('origin', models.CharField(max_length=255)),
                ('grade', models.CharField(max_length=50)),
            ],
            options={
                'ordering': ['seed_type', 'origin', 'grade'],
            },
        ),
        migrations.CreateModel(
            name='Company',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100, unique=True)),
                ('description', models.TextField(blank=True)),
            ],
        ),
        migrations.CreateModel(
            name='DailyRecord',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('date', models.DateField(default=django.utils.timezone.now)),
                ('plant', models.CharField(blank=True, max_length=100)),
                ('operation_type', models.CharField(choices=[('CLEANING', 'Cleaning'), ('RECLEANING', 'Re cleaning'), ('UNLOADING', 'Unloading'), ('LOADING', 'Loading'), ('REJECT_WEIGHING', 'Reject Weighing'), ('RELOCATION', 'Relocation'), ('WEIGHBRIDGE', 'Weighbridge Net')], default='CLEANING', max_length=20)),
                ('target_purity', models.DecimalField(blank=True, decimal_places=2, help_text='Desired final purity in %, e.g., 97.00/98.00/99.00/100.00.', max_digits=5, null=True)),
                ('weight_in', models.DecimalField(decimal_places=2, max_digits=12)),
                ('weight_out', models.DecimalField(decimal_places=2, max_digits=12)),
                ('rejects', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('reject_disposition', models.CharField(choices=[('WASTE', 'Waste'), ('FEED', 'Feed'), ('REWORK', 'Rework')], default='WASTE', max_length=10)),
                ('purity_before', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('purity_after', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('shrink_margin', models.DecimalField(decimal_places=2, default=Decimal('100'), max_digits=5)),
                ('passes', models.SmallIntegerField(default=1)),
                ('remarks', models.TextField(blank=True)),
                ('cleaning_equipment', models.CharField(blank=True, max_length=100)),
                ('chemicals_used', models.TextField(blank=True)),
                ('start_time', models.DateTimeField(blank=True, null=True)),
                ('end_time', models.DateTimeField(blank=True, null=True)),
                ('laborers', models.PositiveIntegerField(default=0)),
                ('labor_rate_per_qtl', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('reject_labor_payment_per_qtl', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('cleaning_labor_rate_etb_per_qtl', models.DecimalField(blank=True, decimal_places=2, help_text='Labor cost per quintal (ETB) for cleaning', max_digits=12, null=True)),
                ('reject_weighing_rate_etb_per_qtl', models.DecimalField(blank=True, decimal_places=2, help_text='Labor cost per quintal (ETB) for reject weighing', max_digits=12, null=True)),
                ('labor_cost', models.DecimalField(decimal_places=2, default=0, editable=False, max_digits=12)),
                ('pieces', models.PositiveIntegerField(default=0)),
                ('recleaning_reason', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_posted', models.BooleanField(default=False)),
                ('posted_at', models.DateTimeField(blank=True, null=True)),
                ('actual_reject_weight', models.DecimalField(blank=True, decimal_places=3, help_text='Measured rejects weight (qtl/kg as per system unit).', max_digits=12, null=True)),
                ('expected_reject_weight', models.DecimalField(blank=True, decimal_places=3, help_text='System expected rejects based on purity/weight.', max_digits=12, null=True)),
                ('combined_expected_reject_weight', models.DecimalField(blank=True, decimal_places=3, help_text='Weighted combo of purity-based and diff-based estimators.', max_digits=12, null=True)),
                ('deviation_pct', models.DecimalField(blank=True, decimal_places=4, help_text='|actual - expected_adj| / weight_in (in fraction, not %).', max_digits=7, null=True)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft / Awaiting reject weight'), ('READY', 'Ready to post'), ('POSTED', 'Posted')], default='DRAFT', max_length=12)),
                ('is_fishy', models.BooleanField(default=False)),
                ('reject_weighed_at', models.DateTimeField(blank=True, null=True)),
                ('lot', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='daily_records', to='WareDGT.bincardentry')),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='processing_logs', to='WareDGT.company')),
                ('posted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='posted_daily_records', to=settings.AUTH_USER_MODEL)),
                ('recorded_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='daily_records', to=settings.AUTH_USER_MODEL)),
                ('reject_weighed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reject_weighings', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-date', '-id'],
                'permissions': [('can_post_daily_record', 'Can post daily record'), ('can_reverse_daily_record', 'Can reverse posted daily record')],
            },
        ),
        migrations.CreateModel(
            name='EcxLoadRequest',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('DECLINED', 'Declined')], default='PENDING', max_length=10)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('decision_note', models.TextField(blank=True)),
                ('approval_token', models.CharField(max_length=64, unique=True)),
                ('payload', models.JSONField(blank=True, default=dict)),
                ('plombs_count', models.PositiveIntegerField(default=0)),
                ('has_trailer', models.BooleanField(default=False)),
                ('trailer_count', models.PositiveIntegerField(default=0)),
                ('truck_image', models.ImageField(blank=True, null=True, upload_to='ecx/trucks/')),
                ('truck_plate_no', models.CharField(blank=True, max_length=20)),
                ('trailer_plate_no', models.CharField(blank=True, max_length=20)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='approved_ecx_load_requests', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_ecx_load_requests', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EcxMovement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('net_obligation_receipt_no', models.CharField(max_length=100)),
                ('warehouse_receipt_no', models.CharField(max_length=100)),
                ('quantity_quintals', models.DecimalField(decimal_places=2, max_digits=12)),
                ('purchase_date', models.DateField(default=django.utils.timezone.now)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('weighbridge_certificate', models.FileField(blank=True, upload_to='ecx_movements/weighbridge/%Y/%m/%d/')),
                ('weighed', models.BooleanField(default=False)),
                ('weighed_at', models.DateTimeField(blank=True, null=True)),
                ('loaded', models.BooleanField(default=False)),
                ('loaded_at', models.DateTimeField(blank=True, null=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_ecx_movements', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-purchase_date', 'warehouse'],
            },
        ),
        migrations.CreateModel(
            name='EcxTrade',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('net_obligation_receipt_no', models.CharField(max_length=100)),
                ('warehouse_receipt_no', models.CharField(max_length=100)),
                ('warehouse_receipt_version', models.PositiveIntegerField(default=1)),
                ('quantity_quintals', models.DecimalField(decimal_places=2, max_digits=12)),
                ('purchase_date', models.DateField(default=django.utils.timezone.now)),
                ('loaded', models.BooleanField(default=False)),
                ('loaded_at', models.DateTimeField(blank=True, null=True)),
                ('commodity', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.commodity')),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='owned_ecx_trades', to='WareDGT.company')),
                ('recorded_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='recorded_ecx_trades', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-purchase_date', 'commodity'],
            },
        ),
        migrations.CreateModel(
            name='EcxTradeRequest',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('category', models.CharField(blank=True, max_length=30)),
                ('symbol', models.CharField(max_length=10)),
                ('grade', models.CharField(max_length=20)),
                ('net_obligation_receipt_no', models.CharField(max_length=100)),
                ('purchase_date', models.DateField(default=django.utils.timezone.now)),
                ('receipt_lines', models.JSONField(default=list)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('DECLINED', 'Declined')], default='PENDING', max_length=10)),
                ('decided_at', models.DateTimeField(blank=True, null=True)),
                ('decision_note', models.TextField(blank=True)),
                ('approval_token', models.CharField(max_length=64, unique=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_ecx_trade_requests', to=settings.AUTH_USER_MODEL)),
                ('decision_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='decided_ecx_trade_requests', to=settings.AUTH_USER_MODEL)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.company')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PurchaseOrder',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('quantity_quintals', models.DecimalField(decimal_places=2, max_digits=12)),
                ('purchase_date', models.DateField(default=django.utils.timezone.now)),
                ('pickup_deadline', models.DateField(editable=False)),
                ('status', models.CharField(default='PENDING', max_length=20)),
            ],
            options={
                'ordering': ['-purchase_date', 'seed_type'],
            },
        ),
        migrations.CreateModel(
            name='SeedType',
            fields=[
                ('code', models.CharField(max_length=10, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100)),
            ],
            options={
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='SeedTypeDetail',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('category', models.CharField(choices=[('COFFEE', 'Coffee'), ('SESAME', 'Sesame'), ('BEANS', 'Beans'), ('OTHER', 'Other')], default='SESAME', help_text='Commodity category', max_length=10)),
                ('coffee_type', models.CharField(blank=True, choices=[('LOCAL_WASHED', 'Local Washed'), ('LOCAL_UNWASHED', 'Local Unwashed'), ('EXPORT_COMMERCIAL_UNWASHED', 'Export Commercial Unwashed'), ('EXPORT_SPECIALTY_UNWASHED', 'Export Specialty Unwashed'), ('EXPORT_COMMERCIAL_WASHED', 'Export Commercial Washed'), ('EXPORT_SPECIALTY_WASHED', 'Export Specialty Washed')], help_text='Coffee grouping tag', max_length=30, null=True)),
                ('symbol', models.CharField(max_length=10)),
                ('name', models.CharField(max_length=100)),
                ('grade', models.CharField(max_length=20)),
                ('origin', models.TextField()),
                ('handling_procedure', models.TextField(blank=True)),
            ],
            options={
                'ordering': ['symbol'],
            },
        ),
        migrations.CreateModel(
            name='StockMovement',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('movement_type', models.CharField(choices=[('IN', 'Inbound'), ('OUT', 'Outbound')], max_length=3)),
                ('ticket_no', models.CharField(max_length=50, unique=True)),
                ('ticket_date', models.DateField()),
                ('enter_time', models.DateTimeField()),
                ('exit_time', models.DateTimeField()),
                ('plate_no', models.CharField(max_length=20)),
                ('gross_weight', models.DecimalField(decimal_places=2, max_digits=12)),
                ('tare_weight', models.DecimalField(decimal_places=2, max_digits=12)),
                ('net_weight', models.DecimalField(decimal_places=2, max_digits=12)),
                ('num_bags', models.IntegerField()),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='stock_movements', to='WareDGT.company')),
                ('purchase_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='movements', to='WareDGT.purchaseorder')),
                ('receiver', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='received_movements', to=settings.AUTH_USER_MODEL)),
                ('seed_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtype')),
                ('supplier', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='supplied_movements', to='WareDGT.company')),
            ],
            options={
                'ordering': ['-ticket_date'],
            },
        ),
        migrations.CreateModel(
            name='WeighbridgeSlipImage',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('image', models.ImageField(help_text='Scan or photo of the weighbridge slip', upload_to='weighbridge_slips/%Y/%m/%d/')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('description', models.CharField(blank=True, help_text="Optional note (e.g. 'inbound slip', 'outbound slip')", max_length=255)),
                ('movement', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='slip_images', to='WareDGT.stockmovement')),
                ('uploaded_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='uploaded_slip_images', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Weighbridge Slip Image',
                'verbose_name_plural': 'Weighbridge Slip Images',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='Warehouse',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(max_length=50, unique=True)),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('warehouse_type', models.CharField(choices=[('DGT', 'DGT'), ('ECX', 'ECX')], max_length=3)),
                ('capacity_quintals', models.DecimalField(decimal_places=2, max_digits=12)),
                ('footprint_m2', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('zone_geojson', models.JSONField(blank=True, null=True)),
                ('latitude', models.DecimalField(decimal_places=6, max_digits=9)),
                ('longitude', models.DecimalField(decimal_places=6, max_digits=9)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='warehouses', to='WareDGT.company')),
            ],
            options={
                'ordering': ['warehouse_type', 'code'],
            },
        ),
        migrations.CreateModel(
            name='UserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(choices=[('WAREHOUSE_OFFICER', 'Warehouse Officer'), ('ECX_OFFICER', 'ECX Officer'), ('ECX_AGENT', 'ECX Agent'), ('WEIGHBRIDGE_OPERATOR', 'Weighbridge Operator'), ('OPERATIONS_MANAGER', 'Logistics Manager'), ('ADMIN', 'System Manager'), ('ACCOUNTANT', 'Accountant')], max_length=20)),
                ('avatar', models.ImageField(blank=True, null=True, upload_to='avatars/')),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('timezone', models.CharField(default='UTC', max_length=50)),
                ('preferences', models.JSONField(blank=True, default=dict)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='profile', to=settings.AUTH_USER_MODEL)),
                ('warehouses', models.ManyToManyField(blank=True, limit_choices_to={'warehouse_type': 'ECX'}, related_name='assigned_users', to='WareDGT.warehouse')),
            ],
        ),
        migrations.CreateModel(
            name='UserEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ts', models.DateTimeField(auto_now_add=True)),
                ('event', models.CharField(max_length=32)),
                ('meta', models.JSONField(blank=True, default=dict)),
                ('actor', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='+', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='StockOutRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('PENDING_SM', 'Pending â€“ System Manager'), ('APPROVED', 'Approved'), ('DECLINED', 'Declined'), ('RETURNED', 'Returned')], default='PENDING', max_length=16)),
                ('approval_token', models.CharField(max_length=64, unique=True)),
                ('reason', models.TextField(blank=True, null=True)),
                ('payload', models.JSONField()),
                ('warehouse_document', models.FileField(blank=True, upload_to='stockout/warehouse_docs/%Y/%m/%d/')),
                ('weighbridge_certificate', models.FileField(blank=True, upload_to='stockout/weighbridge/%Y/%m/%d/')),
                ('pdf_file', models.FileField(blank=True, null=True, upload_to='stockout_requests/%Y/%m/%d/')),
                ('idempotency_key', models.CharField(blank=True, help_text='Client-supplied key to deduplicate submissions', max_length=64, null=True, unique=True)),
                ('is_borrow', models.BooleanField(default=False, help_text='If true, this outflow is a temporary loan to another company.')),
                ('borrower_name', models.CharField(blank=True, max_length=120, null=True)),
                ('lm_approved_at', models.DateTimeField(blank=True, null=True)),
                ('sm_approved_at', models.DateTimeField(blank=True, null=True)),
                ('borrowed_outstanding_kg', models.DecimalField(decimal_places=3, default=Decimal('0.000'), max_digits=14)),
                ('borrower', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='stock_loans', to='WareDGT.company')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='stockout_created', to=settings.AUTH_USER_MODEL)),
                ('lm_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='stockout_lm_approvals', to=settings.AUTH_USER_MODEL)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.company')),
                ('sm_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='stockout_sm_approvals', to=settings.AUTH_USER_MODEL)),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.warehouse')),
            ],
            options={
                'ordering': ('-created_at',),
            },
        ),
        migrations.CreateModel(
            name='StockOut',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('stock_class', models.CharField(choices=[('cleaned', 'Cleaned'), ('reject', 'Reject')], max_length=7)),
                ('quantity_kg', models.DecimalField(decimal_places=3, help_text='Quantity in quintals', max_digits=14)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.company')),
                ('seed_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtypedetail')),
                ('warehouse', models.ForeignKey(limit_choices_to={'warehouse_type': 'DGT'}, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.warehouse')),
            ],
            options={
                'ordering': ['-created_at', '-id'],
            },
        ),
        migrations.AddField(
            model_name='stockmovement',
            name='warehouse',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='movements', to='WareDGT.warehouse'),
        ),
        migrations.AddField(
            model_name='seedtypedetail',
            name='delivery_location',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='seed_type_details', to='WareDGT.warehouse'),
        ),
        migrations.CreateModel(
            name='QualityAnalysis',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('first_sound_weight', models.DecimalField(decimal_places=2, max_digits=10)),
                ('first_foreign_weight', models.DecimalField(decimal_places=2, max_digits=10)),
                ('first_purity_percent', models.DecimalField(decimal_places=2, max_digits=5)),
                ('second_test_datetime', models.DateTimeField()),
                ('second_sound_weight', models.DecimalField(decimal_places=2, max_digits=10)),
                ('second_foreign_weight', models.DecimalField(decimal_places=2, max_digits=10)),
                ('total_bags', models.IntegerField()),
                ('sampled_bags', models.IntegerField()),
                ('second_purity_percent', models.DecimalField(decimal_places=2, max_digits=5)),
                ('comment', models.TextField(blank=True)),
                ('movement', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to='WareDGT.stockmovement')),
            ],
        ),
        migrations.AddField(
            model_name='purchaseorder',
            name='company_warehouse',
            field=models.ForeignKey(limit_choices_to={'warehouse_type': 'DGT'}, on_delete=django.db.models.deletion.PROTECT, related_name='incoming_purchases', to='WareDGT.warehouse'),
        ),
        migrations.AddField(
            model_name='purchaseorder',
            name='ecx_warehouse',
            field=models.ForeignKey(limit_choices_to={'warehouse_type': 'ECX'}, on_delete=django.db.models.deletion.PROTECT, related_name='outgoing_purchases', to='WareDGT.warehouse'),
        ),
        migrations.AddField(
            model_name='purchaseorder',
            name='purchaser',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='purchases', to='WareDGT.company'),
        ),
        migrations.AddField(
            model_name='purchaseorder',
            name='seed_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtype'),
        ),
        migrations.CreateModel(
            name='PurchasedItemType',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('seed_type', models.CharField(max_length=50)),
                ('origin', models.CharField(max_length=255)),
                ('grade', models.CharField(max_length=50)),
                ('description', models.TextField(blank=True)),
            ],
            options={
                'ordering': ['seed_type', 'origin', 'grade'],
                'unique_together': {('seed_type', 'origin', 'grade')},
            },
        ),
        migrations.CreateModel(
            name='EcxTradeRequestFile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(upload_to='ecx_trade_requests/%Y/%m/%d/')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='files', to='WareDGT.ecxtraderequest')),
            ],
            options={
                'ordering': ['uploaded_at'],
            },
        ),
        migrations.AddField(
            model_name='ecxtraderequest',
            name='warehouse',
            field=models.ForeignKey(limit_choices_to={'warehouse_type': 'ECX'}, on_delete=django.db.models.deletion.PROTECT, related_name='ecx_trade_requests', to='WareDGT.warehouse'),
        ),
        migrations.CreateModel(
            name='EcxTradeReceiptFile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(upload_to='ecx_receipts/%Y/%m/%d/')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('trade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='receipt_files', to='WareDGT.ecxtrade')),
            ],
            options={
                'ordering': ['uploaded_at'],
            },
        ),
        migrations.AddField(
            model_name='ecxtrade',
            name='warehouse',
            field=models.ForeignKey(limit_choices_to={'warehouse_type': 'ECX'}, on_delete=django.db.models.deletion.PROTECT, related_name='ecx_trades', to='WareDGT.warehouse'),
        ),
        migrations.CreateModel(
            name='EcxShipment',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('symbol', models.CharField(blank=True, help_text='Seed symbol (e.g., WHGSS)', max_length=10, null=True)),
                ('total_quantity', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('loading_date', models.DateTimeField(blank=True, null=True)),
                ('truck_plate_no', models.CharField(blank=True, max_length=20)),
                ('trailer_plate_no', models.CharField(blank=True, max_length=20)),
                ('truck_image', models.ImageField(blank=True, null=True, upload_to='ecx/trucks/')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL)),
                ('warehouse', models.ForeignKey(limit_choices_to={'warehouse_type': 'ECX'}, on_delete=django.db.models.deletion.PROTECT, related_name='ecx_shipments', to='WareDGT.warehouse')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EcxMovementReceiptFile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('image', models.FileField(upload_to='ecx_movement_receipts/%Y/%m/%d/')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('movement', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='receipt_files', to='WareDGT.ecxmovement')),
            ],
            options={
                'ordering': ['uploaded_at'],
            },
        ),
        migrations.AddField(
            model_name='ecxmovement',
            name='item_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.purchaseditemtype'),
        ),
        migrations.AddField(
            model_name='ecxmovement',
            name='owner',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='owned_ecx_movements', to='WareDGT.company'),
        ),
        migrations.AddField(
            model_name='ecxmovement',
            name='shipment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='movements', to='WareDGT.ecxshipment'),
        ),
        migrations.AddField(
            model_name='ecxmovement',
            name='warehouse',
            field=models.ForeignKey(limit_choices_to={'warehouse_type': 'ECX'}, on_delete=django.db.models.deletion.PROTECT, related_name='ecx_movements', to='WareDGT.warehouse'),
        ),
        migrations.CreateModel(
            name='EcxLoadRequestReceiptFile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('origin', models.CharField(max_length=100)),
                ('grade', models.CharField(max_length=20)),
                ('file', models.FileField(upload_to='ecx_load_request_receipts/%Y/%m/%d/')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='receipt_files', to='WareDGT.ecxloadrequest')),
            ],
            options={
                'ordering': ['uploaded_at'],
            },
        ),
        migrations.AddField(
            model_name='ecxloadrequest',
            name='shipment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='load_requests', to='WareDGT.ecxshipment'),
        ),
        migrations.AddField(
            model_name='ecxloadrequest',
            name='trades',
            field=models.ManyToManyField(related_name='load_requests', to='WareDGT.ecxtrade'),
        ),
        migrations.AddField(
            model_name='ecxloadrequest',
            name='warehouse',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='ecx_load_requests', to='WareDGT.warehouse'),
        ),
        migrations.CreateModel(
            name='EcxLoad',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('tracking_no', models.CharField(max_length=50)),
                ('voucher_no', models.CharField(max_length=50)),
                ('voucher_weight', models.DecimalField(decimal_places=2, max_digits=12)),
                ('gross_weight', models.DecimalField(decimal_places=2, max_digits=12)),
                ('net_weight', models.DecimalField(decimal_places=2, max_digits=12)),
                ('truck_plate_no', models.CharField(max_length=20)),
                ('trailer_plate_no', models.CharField(max_length=20)),
                ('no_of_plomps', models.IntegerField()),
                ('trailer_no_of_plomps', models.IntegerField()),
                ('scale_ticket_no', models.CharField(max_length=50)),
                ('driver_name', models.CharField(max_length=100)),
                ('driver_license_no', models.CharField(max_length=50)),
                ('driver_license_image', models.ImageField(upload_to='driver_licenses/%Y/%m/%d/')),
                ('no_of_bags', models.IntegerField()),
                ('production_year', models.IntegerField()),
                ('region', models.CharField(max_length=100)),
                ('zone', models.CharField(max_length=100)),
                ('woreda', models.CharField(max_length=100)),
                ('specific_area', models.CharField(max_length=100)),
                ('date_received', models.DateField()),
                ('supervisor_name', models.CharField(max_length=100)),
                ('supervisor_signed_date', models.DateField()),
                ('client_name', models.CharField(max_length=100)),
                ('client_signed_date', models.DateField()),
                ('dispatch_document', models.FileField(upload_to='dispatch_docs/%Y/%m/%d/')),
                ('weight_certificate', models.FileField(upload_to='weight_certificates/%Y/%m/%d/')),
                ('commodity_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtype')),
                ('trades', models.ManyToManyField(related_name='loads', to='WareDGT.ecxtrade')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.warehouse')),
            ],
            options={
                'ordering': ['-date_received', 'warehouse'],
            },
        ),
        migrations.CreateModel(
            name='DashboardConfig',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(max_length=30, unique=True)),
                ('widgets', models.JSONField(blank=True, default=dict)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='DailyRecordAssessment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('pre_operation', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('in_operation', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('post_operation', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('tolerance', models.DecimalField(decimal_places=2, max_digits=12)),
                ('spread', models.DecimalField(decimal_places=2, max_digits=12)),
                ('flagged', models.BooleanField(default=False)),
                ('reason', models.TextField(blank=True)),
                ('daily_record', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='assessment', to='WareDGT.dailyrecord')),
            ],
            options={
                'ordering': ['daily_record'],
            },
        ),
        migrations.AddField(
            model_name='dailyrecord',
            name='seed_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtypedetail'),
        ),
        migrations.AddField(
            model_name='dailyrecord',
            name='warehouse',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='daily_records', to='WareDGT.warehouse'),
        ),
        migrations.AddField(
            model_name='dailyrecord',
            name='workers',
            field=models.ManyToManyField(blank=True, related_name='daily_cleaning_workers', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='ContractMovementRequest',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('DECLINED', 'Declined')], default='PENDING', max_length=10)),
                ('approval_token', models.CharField(db_index=True, default=WareDGT.models.generate_cmr_token, max_length=64, unique=True)),
                ('direction', models.CharField(choices=[('IN', 'IN'), ('OUT', 'OUT')], default='IN', max_length=8)),
                ('payload', models.JSONField()),
                ('dispatch_image', models.FileField(blank=True, upload_to='contract_dispatch/%Y/%m/%d/')),
                ('decided_at', models.DateTimeField(blank=True, null=True)),
                ('decision_note', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_contract_movement_requests', to=settings.AUTH_USER_MODEL)),
                ('decision_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='decided_contract_movement_requests', to=settings.AUTH_USER_MODEL)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.company')),
                ('warehouse', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.warehouse')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='commodity',
            name='seed_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtype'),
        ),
        migrations.CreateModel(
            name='CleanedStockOut',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(auto_now_add=True)),
                ('in_out_no', models.CharField(blank=True, max_length=50, validators=[django.core.validators.RegexValidator('^\\d+$', 'In/out number must be numeric')])),
                ('weight', models.DecimalField(decimal_places=2, max_digits=12)),
                ('num_bags', models.IntegerField(default=0)),
                ('car_plate_number', models.CharField(blank=True, max_length=20)),
                ('warehouse_document_number', models.CharField(blank=True, max_length=50)),
                ('weighbridge_certificate', models.FileField(blank=True, upload_to='bincard/weighbridge/%Y/%m/%d/')),
                ('warehouse_document', models.FileField(blank=True, upload_to='bincard/warehouse_docs/%Y/%m/%d/')),
                ('loading_rate_etb_per_qtl', models.DecimalField(blank=True, decimal_places=4, help_text='Labor cost per quintal (ETB) for loading', max_digits=12, null=True)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.company')),
                ('seed_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtypedetail')),
                ('warehouse', models.ForeignKey(limit_choices_to={'warehouse_type': 'DGT'}, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.warehouse')),
            ],
            options={
                'ordering': ['-date', '-id'],
            },
        ),
        migrations.CreateModel(
            name='BinCardEntryRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('DECLINED', 'Declined')], default='PENDING', max_length=16)),
                ('approval_token', models.CharField(max_length=64, unique=True)),
                ('reason', models.TextField(blank=True, null=True)),
                ('payload', models.JSONField()),
                ('direction', models.CharField(choices=[('IN', 'IN'), ('OUT', 'OUT')], max_length=8)),
                ('warehouse_document', models.FileField(blank=True, upload_to='bincard/warehouse_docs/%Y/%m/%d/')),
                ('weighbridge_certificate', models.FileField(blank=True, upload_to='bincard/weighbridge/%Y/%m/%d/')),
                ('quality_form', models.FileField(blank=True, upload_to='bincard/quality_forms/%Y/%m/%d/')),
                ('pdf_file', models.FileField(blank=True, null=True, upload_to='bincard_drafts/%Y/%m/%d/')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='bcr_created', to=settings.AUTH_USER_MODEL)),
                ('warehouse', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.warehouse')),
            ],
            options={
                'ordering': ('-created_at',),
            },
        ),
        migrations.AddField(
            model_name='bincardentry',
            name='ecx_movement',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='bin_card_entries', to='WareDGT.ecxmovement'),
        ),
        migrations.AddField(
            model_name='bincardentry',
            name='owner',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.company'),
        ),
        migrations.AddField(
            model_name='bincardentry',
            name='seed_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtypedetail'),
        ),
        migrations.AddField(
            model_name='bincardentry',
            name='warehouse',
            field=models.ForeignKey(limit_choices_to={'warehouse_type': 'DGT'}, on_delete=django.db.models.deletion.PROTECT, related_name='bin_card_entries', to='WareDGT.warehouse'),
        ),
        migrations.CreateModel(
            name='BinCardAttachment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('kind', models.CharField(choices=[('ecx_receipt', 'ECX receipt'), ('weighbridge', 'Weighbridge'), ('warehouse_doc', 'Warehouse Doc'), ('quality_form', 'Quality Form')], max_length=32)),
                ('file', models.FileField(upload_to='bincard/attachments/%Y/%m/%d/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('entry', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='WareDGT.bincardentry')),
            ],
        ),
        migrations.CreateModel(
            name='BinCard',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('commodity', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bin_cards', to='WareDGT.commodity')),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bin_cards', to='WareDGT.company')),
                ('warehouse', models.ForeignKey(limit_choices_to={'warehouse_type': 'DGT'}, on_delete=django.db.models.deletion.CASCADE, related_name='bin_cards', to='WareDGT.warehouse')),
            ],
        ),
        migrations.AlterUniqueTogether(
            name='stockmovement',
            unique_together={('movement_type', 'ticket_no')},
        ),
        migrations.AlterUniqueTogether(
            name='seedtypedetail',
            unique_together={('symbol', 'delivery_location')},
        ),
        migrations.CreateModel(
            name='SeedTypeBalance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('purity', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('cleaned_kg', models.DecimalField(decimal_places=3, default=Decimal('0.000'), help_text='Cleaned stock (quintals)', max_digits=14)),
                ('rejects_kg', models.DecimalField(decimal_places=3, default=Decimal('0.000'), help_text='Reject stock (quintals)', max_digits=14)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.company')),
                ('seed_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtypedetail')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.warehouse')),
            ],
            options={
                'unique_together': {('warehouse', 'owner', 'seed_type', 'purity')},
            },
        ),
        migrations.CreateModel(
            name='SeedGradeParameter',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('grade', models.CharField(max_length=20)),
                ('min_purity', models.DecimalField(decimal_places=2, max_digits=5, verbose_name='Min purity (%)')),
                ('max_purity', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Max purity (%)')),
                ('seed_type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='grading_parameters', to='WareDGT.seedtypedetail')),
            ],
            options={
                'ordering': ['seed_type', '-min_purity'],
                'unique_together': {('seed_type', 'grade')},
            },
        ),
        migrations.CreateModel(
            name='QualityCheck',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('index', models.PositiveIntegerField()),
                ('timestamp', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('sample_weight_g', models.DecimalField(decimal_places=2, default=Decimal('30.00'), max_digits=6)),
                ('piece_quintals', models.DecimalField(decimal_places=2, default=Decimal('50.00'), max_digits=8)),
                ('machine_rate_kgph', models.DecimalField(decimal_places=2, default=Decimal('50.00'), max_digits=8)),
                ('weight_sound_g', models.DecimalField(decimal_places=2, max_digits=8)),
                ('weight_reject_g', models.DecimalField(decimal_places=2, max_digits=8)),
                ('purity_percent', models.DecimalField(decimal_places=2, editable=False, max_digits=5)),
                ('daily_record', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quality_checks', to='WareDGT.dailyrecord')),
            ],
            options={
                'ordering': ['index'],
                'unique_together': {('daily_record', 'index')},
            },
        ),
        migrations.CreateModel(
            name='LaborPayment',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('date', models.DateField()),
                ('degami_second_clean', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('yetemezene_weighting', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('gravity_cleaning', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('rebag_quantity', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('sabiyan_quantity', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('payment_balance', models.DecimalField(decimal_places=2, max_digits=12)),
                ('remark', models.TextField(blank=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.company')),
                ('seed_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtype')),
            ],
            options={
                'ordering': ['date', 'seed_type'],
                'unique_together': {('date', 'seed_type', 'owner')},
            },
        ),
        migrations.AlterUniqueTogether(
            name='ecxtrade',
            unique_together={('warehouse_receipt_no', 'warehouse_receipt_version')},
        ),
        migrations.CreateModel(
            name='ContractMovement',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('category', models.CharField(choices=[('COFFEE', 'Coffee'), ('SESAME', 'Sesame'), ('BEANS', 'Beans'), ('OTHER', 'Other')], max_length=10)),
                ('symbol', models.CharField(help_text='Seed symbol (e.g., WHSS, WOLS)', max_length=10)),
                ('origin', models.CharField(blank=True, max_length=255)),
                ('agent_name', models.CharField(blank=True, max_length=100)),
                ('agent_phone', models.CharField(blank=True, max_length=50)),
                ('advice_number', models.CharField(blank=True, max_length=100)),
                ('dispatch_number', models.CharField(max_length=100)),
                ('dispatch_image', models.FileField(blank=True, upload_to='contract_dispatch/%Y/%m/%d/')),
                ('quantity_quintals', models.DecimalField(decimal_places=2, default=0, help_text='Registered load quantity (qtls)', max_digits=12)),
                ('notes', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('IN_TRANSIT', 'In Transit'), ('CONSUMED', 'Consumed')], default='IN_TRANSIT', max_length=12)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('used_at', models.DateTimeField(blank=True, null=True)),
                ('consumed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='consumed_contract_movements', to='WareDGT.bincardentry')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_contract_movements', to=settings.AUTH_USER_MODEL)),
                ('owner', models.ForeignKey(blank=True, help_text='Owning company (defaults to DGT if omitted)', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='contract_movements', to='WareDGT.company')),
            ],
            options={
                'ordering': ['-created_at', 'symbol'],
                'indexes': [models.Index(fields=['status', 'symbol'], name='WareDGT_con_status_8b2940_idx'), models.Index(fields=['dispatch_number'], name='WareDGT_con_dispatc_fe1fc3_idx')],
            },
        ),
        migrations.AlterUniqueTogether(
            name='commodity',
            unique_together={('seed_type', 'origin', 'grade')},
        ),
        migrations.CreateModel(
            name='BinCardTransaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ts', models.DateTimeField(auto_now_add=True)),
                ('movement', models.CharField(choices=[('RAW_OUT', 'Raw Out'), ('CLEANED_IN', 'Cleaned In'), ('REJECT_OUT', 'Reject Out'), ('CLEANED_OUT', 'Cleaned Out')], max_length=20)),
                ('qty_kg', models.DecimalField(decimal_places=3, max_digits=12)),
                ('grade_before', models.CharField(blank=True, max_length=50, null=True)),
                ('grade_after', models.CharField(blank=True, max_length=50, null=True)),
                ('note', models.TextField(blank=True, null=True)),
                ('commodity', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='WareDGT.seedtypedetail')),
                ('daily_record', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to='WareDGT.dailyrecord')),
                ('lot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to='WareDGT.bincardentry')),
                ('warehouse', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='WareDGT.warehouse')),
            ],
            options={
                'ordering': ['ts', 'id'],
                'indexes': [models.Index(fields=['lot', 'ts'], name='WareDGT_bin_lot_id_f8a772_idx'), models.Index(fields=['commodity', 'warehouse', 'ts'], name='WareDGT_bin_commodi_d6e648_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='bincardtransaction',
            constraint=models.UniqueConstraint(condition=models.Q(('daily_record__isnull', False)), fields=('daily_record', 'movement'), name='uniq_daily_record_movement'),
        ),
        migrations.AlterUniqueTogether(
            name='bincardentry',
            unique_together={('seed_type', 'owner', 'warehouse', 'in_out_no')},
        ),
        migrations.AddIndex(
            model_name='bincardattachment',
            index=models.Index(fields=['entry', 'kind'], name='WareDGT_bin_entry_i_396959_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='bincard',
            unique_together={('owner', 'commodity', 'warehouse')},
        ),
    ]
